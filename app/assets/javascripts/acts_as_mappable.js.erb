(function($, undefined) {
    initToMap = function() {
	var div = $("#map-canvas"),
	lat = Number(div.data("lat")),
	lng = Number(div.data("lng")),
	latlng = new google.maps.LatLng(lat, lng);
	var mapOptions = {
	    mapTypeId: google.maps.MapTypeId.ROADMAP,
	    center: latlng,
	    zoom: 12
	};
	var map = new google.maps.Map(div[0], mapOptions);
	var marker = new google.maps.Marker({
	    map: map,
	    position: latlng,
	    title: div.prop("title")
	});
    };

    apiKey = "<%= ActsAsMappable::Mappable::Config.api_key %>";
    loadApi = function() {
	var script = document.createElement("script");
	script.type = "text/javascript";
	src = "http://maps.googleapis.com/maps/api/js?sensor=false&callback=initToMap";
	if (apiKey) {
	    src = src + "&key=" + apiKey;
	}
	script.src = src;
	document.body.appendChild(script);
    };

    window.onload = loadApi;
})(jQuery);
